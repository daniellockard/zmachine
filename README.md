<div align="center">

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                           â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•‘
â•‘   â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•      â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•  â•‘
â•‘     â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â•‘
â•‘    â–ˆâ–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•    â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•‘
â•‘   â•šâ•â•â•â•â•â•â•      â•šâ•â•     â•šâ•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•  â•‘
â•‘                                                                           â•‘
â•‘          âš¡ A Modern TypeScript Z-Machine Emulator âš¡                    â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Run classic Infocom text adventures in Node.js or the browser

<br/>

[![npm version](https://img.shields.io/npm/v/zmachine?style=for-the-badge&logo=npm&logoColor=white&color=CB3837)](https://www.npmjs.com/package/zmachine)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=for-the-badge&logo=opensourceinitiative&logoColor=white)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Zero Dependencies](https://img.shields.io/badge/Dependencies-0-success?style=for-the-badge&logo=checkmarx&logoColor=white)](package.json)

[![Tests](https://img.shields.io/badge/Tests-898+-success?style=flat-square&logo=vitest&logoColor=white)](https://vitest.dev/)
[![Coverage](https://img.shields.io/badge/Coverage-99.79%25-brightgreen?style=flat-square&logo=codecov&logoColor=white)](coverage/index.html)
[![Node.js](https://img.shields.io/badge/Node.js-339933?style=flat-square&logo=nodedotjs&logoColor=white)](https://nodejs.org/)
[![Browser](https://img.shields.io/badge/Browser-Ready-blue?style=flat-square&logo=googlechrome&logoColor=white)](#browser)

---

**[ğŸ“– Documentation](#api-reference)** Â· **[ğŸš€ Quick Start](#quick-start)** Â· **[ğŸ® Live Demo](https://daniellockard.github.io/zmachine/)** Â· **[ğŸ“¦ npm](https://www.npmjs.com/package/zmachine)**

</div>

---

## ğŸ“‹ Table of Contents

- [âœ¨ Features](#-features)
- [ğŸ“¦ Installation](#-installation)
- [ğŸš€ Quick Start](#-quick-start)
- [ğŸ® Web Demo](#-web-demo)
- [ğŸ“Š Supported Versions](#-supported-versions)
- [ğŸ”§ I/O Adapter Interface](#-io-adapter-interface)
- [ğŸ“– API Reference](#-api-reference)
- [ğŸ—ï¸ Building](#ï¸-building)
- [ğŸ§ª Testing](#-testing)
- [ğŸ“š Resources](#-resources)
- [ğŸ“„ License](#-license)

---

## âœ¨ Features

<table>
<tr>
<td width="50%">

### ğŸ® Classic Gaming
Run legendary Infocom titles: **Zork**, **Planetfall**, **Hitchhiker's Guide**, **Enchanter**, and 100+ more games from the golden age of interactive fiction.

### ğŸš€ Zero Dependencies
Pure TypeScript with **no runtime dependencies** in the core engine. Just clean, modern JavaScript.

### ğŸŒ Universal Platform
Works seamlessly in **Node.js** and all **modern browsers**. One codebase, everywhere.

</td>
<td width="50%">

### ğŸ“¦ Tree-Shakeable
Import only what you need. The core engine is modular and optimized for minimal bundle size.

### ğŸ”§ Extensible Architecture
Implement your own `IOAdapter` to connect the Z-machine to any platformâ€”terminals, GUIs, bots, or embedded systems.

### âœ… Battle-Tested
**898+ unit tests** with **99.79% code coverage**. Quetzal-compatible save format with full undo support.

</td>
</tr>
</table>

---

## ğŸ“¦ Installation

```bash
npm install zmachine
```

<details>
<summary>ğŸ“‹ <b>Also available via yarn, pnpm, or bun</b></summary>

```bash
yarn add zmachine
pnpm add zmachine
bun add zmachine
```

</details>

---

## ğŸš€ Quick Start

### ğŸ’» Node.js

```typescript
import { ZMachine, IOAdapter } from 'zmachine';
import { readFileSync } from 'fs';

// Implement your I/O adapter
class ConsoleIO implements IOAdapter {
  print(text: string) { process.stdout.write(text); }
  newLine() { console.log(); }
  // ... implement other methods
}

// Load and run a story
const storyData = readFileSync('zork1.z3');
const io = new ConsoleIO();
const zm = ZMachine.load(storyData, io);

await zm.run();
```

### ğŸŒ Browser

```typescript
import { ZMachine } from 'zmachine';
import { WebIOAdapter } from 'zmachine/web';

// Set up DOM elements
const output = document.getElementById('output');
const input = document.getElementById('input');
const status = document.getElementById('status');

// Create I/O adapter
const io = new WebIOAdapter({
  outputElement: output,
  inputElement: input,
  statusElement: status,
});

// Load story file
const response = await fetch('zork1.z3');
const storyData = await response.arrayBuffer();

// Create and run machine
const zm = ZMachine.load(storyData, io);
io.initialize(zm.version);
await zm.run();
```

---

## ğŸ® Web Demo

<div align="center">

### ğŸŒ [**Try it live!** â†’ daniellockard.github.io/zmachine](https://daniellockard.github.io/zmachine/)

> ğŸ•¹ï¸ Play classic text adventures directly in your browser â€” no installation required!

</div>

Or run locally:

```bash
npm run dev:web
```

Then open **http://localhost:8080** and drag-and-drop a story file to start playing!

<details>
<summary>ğŸ–¼ï¸ <b>Screenshot Preview</b></summary>

<br/>

The web demo features a retro terminal aesthetic with:
- ğŸ“Ÿ Classic green-on-black CRT styling
- âŒ¨ï¸ Full keyboard input support
- ğŸ’¾ Save/restore game state
- ğŸ“œ Transcript recording
- ğŸ¨ Z-machine text styling (bold, italic, colors)

</details>

---

## ğŸ“Š Supported Versions

<div align="center">

| Version | Status | Era | Notable Games |
|:-------:|:------:|:---:|:-------------|
| **V1** | âœ… Full | 1980 | Early Zork prototypes |
| **V2** | âœ… Full | 1981 | Early Infocom games |
| **V3** | âœ… Full | 1982-1987 | Zork I-III, Planetfall, Hitchhiker's, Enchanter trilogy |
| **V4** | âœ… Full | 1985-1988 | A Mind Forever Voyaging, Trinity, Bureaucracy |
| **V5** | âœ… Full | 1987+ | Beyond Zork, Sherlock, most Inform games |
| **V6** | âš ï¸ Partial | 1988+ | Graphics games (Shogun, Zork Zero, Arthur) |
| **V7** | âœ… Full | â€” | Large V5 variant |
| **V8** | âœ… Full | â€” | Large V5 variant, modern Inform games |

</div>

> **Note:** V6 games require graphics/mouse support which is not implemented. Text-only features work.

<details>
<summary>ğŸ“œ <b>Full Feature Support Matrix</b></summary>

### âœ… Fully Implemented

| Category | Features |
|----------|----------|
| **Text Output** | print, print_ret, new_line, print_char, print_num, print_addr, print_paddr, print_obj, print_unicode |
| **Text Input** | read (sread/aread), read_char with timeout support, tokenization |
| **Arithmetic** | add, sub, mul, div, mod, random, log_shift, art_shift |
| **Logic** | and, or, not, test, test_attr |
| **Comparison** | je, jl, jg, jz, jin |
| **Control Flow** | call, call_1n/2n/vn/vs, ret, ret_popped, rtrue, rfalse, jump, piracy |
| **Variables** | load, store, inc, dec, inc_chk, dec_chk, pull, push, loadw, loadb, storew, storeb |
| **Objects** | get_parent, get_child, get_sibling, get_prop, get_prop_addr, get_prop_len, get_next_prop, put_prop, insert_obj, remove_obj, set_attr, clear_attr, test_attr, print_obj |
| **Screen** | split_window, set_window, erase_window, erase_line, set_cursor, get_cursor, set_text_style, set_colour, set_font, buffer_mode |
| **Sound** | sound_effect (beeps only, sounds 1 & 2) |
| **Streams** | output_stream (screen, transcript, memory table), input_stream |
| **Save/Restore** | save, restore (Quetzal format), save_undo, restore_undo |
| **Tables** | copy_table, scan_table, print_table |
| **Misc** | verify, quit, restart, show_status, nop, check_arg_count, catch, throw, tokenise, encode_text, check_unicode |

### âŒ Not Implemented (V6 Graphics)

These features are exclusive to V6 games and require a graphics layer:

- **Picture opcodes**: draw_picture, picture_data, erase_picture, set_margins, picture_table
- **Mouse support**: mouse_window, read_mouse
- **Graphics windows**: move_window, window_size, window_style, scroll_window, set_true_colour (extended)
- **Font metrics**: get_wind_prop, put_wind_prop, make_menu

</details>

---

## ğŸ”§ I/O Adapter Interface

Implement the `IOAdapter` interface to connect the Z-machine to your platform:

<details>
<summary>ğŸ“‹ <b>View Full Interface Definition</b></summary>

```typescript
interface IOAdapter {
  // Lifecycle
  initialize?(version: number): void;
  
  // Text output
  print(text: string): void;
  printLine?(text: string): void;
  newLine(): void;
  
  // Input (async)
  readLine(maxLength: number, timeout?: number): Promise<ReadLineResult>;
  readChar(timeout?: number): Promise<number>;
  
  // Screen management
  showStatusLine(location: string, score: number, turns: number, isTime: boolean): void;
  splitWindow(lines: number): void;
  setWindow(window: number): void;
  eraseWindow(window: number): void;
  eraseLine?(): void;
  setCursor?(line: number, column: number): void;
  getCursor?(): { line: number; column: number };
  setTextStyle?(style: number): void;
  setForegroundColor?(color: number): void;
  setBackgroundColor?(color: number): void;
  
  // Sound
  soundEffect?(number: number, effect: number, volume: number): void;
  
  // Streams
  setOutputStream?(stream: number, enabled: boolean, table?: number): void;
  
  // Save/restore
  save(data: Uint8Array): Promise<boolean>;
  restore(): Promise<Uint8Array | null>;
  
  // Game control
  quit(): void;
  restart(): void;
}
```

</details>

---

## ğŸ“– API Reference

### ğŸ–¥ï¸ ZMachine

The main class for running Z-machine games.

```typescript
// Load a story file
const zm = ZMachine.load(storyData: ArrayBuffer, io: IOAdapter);

// Or use constructor directly
const zm = new ZMachine(storyData, io);

// Run until halted or waiting for input
const state = await zm.run();  // Returns RunState

// Access game state
zm.version      // Z-machine version (1-8)
zm.state        // RunState: Stopped, Running, WaitingForInput, Halted
zm.memory       // Direct memory access
zm.header       // Header fields

// Utilities
zm.getObjectName(objectNum)   // Get object's short name
zm.printText(address)         // Decode text at address
zm.lookupWord(word)           // Look up word in dictionary
zm.restart()                  // Restart the game
```

<details>
<summary>ğŸ’¾ <b>Memory Access</b></summary>

Low-level memory access for tools and debugging:

```typescript
const value = zm.memory.readWord(address);   // Read 16-bit word (big-endian)
const byte = zm.memory.readByte(address);    // Read 8-bit byte
zm.memory.writeWord(address, value);         // Write 16-bit word
zm.memory.writeByte(address, value);         // Write 8-bit byte
```

</details>

<details>
<summary>ğŸ“ <b>Text Encoding/Decoding</b></summary>

```typescript
import { ZCharDecoder, ZCharEncoder, ZSCII } from 'zmachine';

// Decode Z-characters to string
const decoder = new ZCharDecoder(memory, version, abbreviationsAddr);
const { text, bytesRead } = decoder.decode(address);

// Encode string to Z-characters (for dictionary lookup)
const encoder = new ZCharEncoder(version);
const encoded = encoder.encode('zork');

// ZSCII character conversion
const unicode = ZSCII.toUnicode(zsciiCode);
const zscii = ZSCII.fromUnicode(unicodeChar);
```

</details>

<details>
<summary>ğŸ’½ <b>GameState (Save/Restore)</b></summary>

```typescript
import { GameState, Quetzal } from 'zmachine';

// Create save state
const state = GameState.capture(zmachine);
const quetzalData = Quetzal.write(state, originalStoryData);

// Restore from Quetzal file
const state = Quetzal.read(quetzalData, originalStoryData);
GameState.restore(zmachine, state);
```

</details>

<details>
<summary>ğŸŒ <b>WebIOAdapter Features</b></summary>

The built-in `WebIOAdapter` includes:

- **Text styling**: Bold, italic, fixed-width, reverse video
- **Colors**: All 8 standard Z-machine colors
- **Status line**: Score/moves or time display
- **Sound**: Beep effects via Web Audio API
- **Save/Restore**: File download/upload with localStorage backup
- **Transcript**: Downloadable game transcript
- **Recording**: Record and playback input sessions

```typescript
const io = new WebIOAdapter({
  outputElement: document.getElementById('output'),
  inputElement: document.getElementById('input'),
  statusElement: document.getElementById('status'),
  onQuit: () => console.log('Game ended'),
  onRestart: () => location.reload(),
});

// Enable transcript
io.setOutputStream(2, true);
io.downloadTranscript();

// Record inputs
io.startRecording();
// ... play game ...
io.stopRecording();
io.downloadRecording();

// Playback recorded inputs
io.loadPlayback(['north', 'take lamp', 'light lamp']);
```

</details>

---

## ğŸ—ï¸ Building

```bash
npm install
npm run build          # Compile TypeScript
npm run build:web      # Build web player
npm run build:lib      # Build npm library
npm run dev:web        # Start web dev server
```

---

## ğŸ§ª Testing

<div align="center">

| Command | Description | Tests |
|---------|-------------|-------|
| `npm test` | Core tests | 817 |
| `npm run test:web` | Web tests | 81 |
| `npm run test:all` | All tests | 898+ |
| `npm run test:coverage` | With coverage | 99.79% |

</div>

```bash
npm test               # Run core tests
npm run test:watch     # Watch mode
npm run test:coverage  # Generate coverage report
npm run lint           # ESLint check
```

---

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ core/              # ğŸ¯ Zero-dependency core
â”‚   â”œâ”€â”€ cpu/           #    Stack and call frames
â”‚   â”œâ”€â”€ dictionary/    #    Word lookup and tokenization
â”‚   â”œâ”€â”€ execution/     #    Opcode execution engine (102 handlers)
â”‚   â”œâ”€â”€ instructions/  #    Opcode definitions and decoder
â”‚   â”œâ”€â”€ memory/        #    Memory and header access
â”‚   â”œâ”€â”€ objects/       #    Object tree and properties
â”‚   â”œâ”€â”€ state/         #    Save/restore and Quetzal format
â”‚   â”œâ”€â”€ text/          #    ZSCII and Z-character encoding
â”‚   â”œâ”€â”€ variables/     #    Variable access (locals, globals, stack)
â”‚   â””â”€â”€ ZMachine.ts    #    Main VM class
â”œâ”€â”€ io/                # ğŸ”Œ I/O adapter interfaces
â”œâ”€â”€ types/             # ğŸ“ TypeScript type definitions
â”œâ”€â”€ web/               # ğŸŒ Browser-based player
â”‚   â”œâ”€â”€ WebIOAdapter.ts
â”‚   â””â”€â”€ main.ts
â””â”€â”€ index.ts           # ğŸ“¦ Public API exports
```

---

## ğŸ² Finding Story Files

Story files (`.z3`, `.z5`, `.z8`, etc.) are copyrighted. Here's where to get them legally:

| Source | Type | Description |
|--------|------|-------------|
| ğŸ›’ [GOG.com](https://www.gog.com) | Commercial | Infocom collections for sale |
| ğŸ“š [IF Archive](https://ifarchive.org/) | Free | Thousands of free Inform games |
| âœï¸ [Inform 7](http://inform7.com/) | Create | Write your own Z-machine games |
| ğŸ”§ [ZILF](https://foss.heptapod.net/zilf/zilf) | Create | Write games in ZIL (original Infocom language) |

> **Tip:** Place story files in a `roms/` folder (gitignored) for integration testing.

---

## ğŸ“š Resources

<table>
<tr>
<td>

**ğŸ“– Specifications**
- [Z-Machine Specification v1.1](https://www.inform-fiction.org/zmachine/standards/z1point1/) â€” The definitive reference
- [Quetzal Save Format](http://inform-fiction.org/zmachine/standards/quetzal/) â€” Standard save format

</td>
<td>

**ğŸ® Interactive Fiction**
- [IF Archive](https://ifarchive.org/) â€” Massive IF repository
- [IFDB](https://ifdb.org/) â€” Interactive Fiction Database
- [r/interactivefiction](https://reddit.com/r/interactivefiction) â€” Reddit community

</td>
</tr>
</table>

---

## ğŸ¤ Contributing

Contributions are welcome! Please read the [Contributing Guide](CONTRIBUTING.md) for guidelines.

```bash
git clone https://github.com/dlockard/zmachine.git
cd zmachine
npm install
npm test
```

---

## ğŸ“„ License

<div align="center">

MIT Â© [Daniel Lockard](https://github.com/dlockard)

---

<sub>

Made with â˜• and a love for classic interactive fiction.

**[â¬† Back to top](#)**

</sub>

</div>
